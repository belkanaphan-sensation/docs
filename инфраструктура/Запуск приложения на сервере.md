# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–°–µ—Ä–≤–µ—Ä + Kubernetes + Helm + FluxCD + GitHub. –í—Å—ë –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω–æ–µ –∫ ¬´–ø—Ä–æ–¥—É¬ª.

---

## 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (Linux, root –¥–æ—Å—Ç—É–ø):

```bash
# –û–±–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç—ã
sudo apt update && sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker (–Ω—É–∂–µ–Ω –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤)
curl -fsSL https://get.docker.com | sh

# –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker —á—Ç–æ–±—ã –∑–∞—Ö–æ–¥–∏—Ç—å –±–µ–∑ sudo (–ø–æ—Å–ª–µ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–π—Ç–∏ –≤ —Å–µ—Å—Å–∏—é)
sudo usermod -aG docker $USER
```

**–í–∞–∂–Ω–æ:** –í—ã–π–¥–∏ –∏ –∑–∞–π–¥–∏ —Å–Ω–æ–≤–∞, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.

---

## 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Kubernetes (k3s)

–°–∞–º—ã–π —É–¥–æ–±–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ ‚Äî **k3s** (–ª—ë–≥–∫–∞—è –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏—è Kubernetes).

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ k3s —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
curl -sfL https://get.k3s.io | sh -s - server --write-kubeconfig-mode 644
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ë–µ–∑ —Ñ–ª–∞–≥–∞ `--write-kubeconfig-mode 644` –º—ã –Ω–µ —Å–º–æ–∂–µ–º —á–∏—Ç–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏ –Ω–µ –∏–∑-–ø–æ–¥ root.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ß—Ç–æ–±—ã —á–∏—Ç–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏ –Ω–µ —Ç–æ–ª—å–∫–æ –∏–∑-–ø–æ–¥ root:

```bash
export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
kubectl get nodes
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** K3s –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç `kubectl` –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç –µ–≥–æ –∫–æ–Ω—Ñ–∏–≥.

---

## 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Helm

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Helm
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏
helm version
```

---

## 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ FluxCD (GitOps –æ–ø–µ—Ä–∞—Ç–æ—Ä)

FluxCD –±—É–¥–µ—Ç —Å–ª–µ–¥–∏—Ç—å –∑–∞ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º –∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏.

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ FluxCD CLI
curl -s https://fluxcd.io/install.sh | sudo bash

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏
flux --version
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ FluxCD –≤ –∫–ª–∞—Å—Ç–µ—Ä

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ kubectl
mkdir -p ~/.kube

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ k3s
sudo cp /etc/rancher/k3s/k3s.yaml ~/.kube/config

# –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo chown $(id -u):$(id -g) ~/.kube/config
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ FluxCD –≤ –∫–ª–∞—Å—Ç–µ—Ä

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ FluxCD –≤ –∫–ª–∞—Å—Ç–µ—Ä
flux install

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–æ–≤ FluxCD
kubectl get pods -n flux-system
```

### –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã `chown`

–ö–æ–º–∞–Ω–¥–∞ `sudo chown $(id -u):$(id -g) ~/.kube/config` –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:

- `chown` ‚Üí **change owner** (—Å–º–µ–Ω–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ñ–∞–π–ª–∞)
- `$(id -u)` ‚Üí –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç **uid** (—á–∏—Å–ª–æ–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- `$(id -g)` ‚Üí –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç **gid** (–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≥—Ä—É–ø–ø—ã)
- `~/.kube/config` ‚Üí —Ñ–∞–π–ª, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –º–µ–Ω—è–µ–º –≤–ª–∞–¥–µ–ª—å—Ü–∞

**–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:**

–§–∞–π–ª `/etc/rancher/k3s/k3s.yaml` —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ—Ç **root**, –∏ –∫–æ–≥–¥–∞ –≤—ã –∫–æ–ø–∏—Ä—É–µ—Ç–µ –µ–≥–æ –≤ —Å–≤–æ–π `~/.kube/config` —Å –ø–æ–º–æ—â—å—é `sudo cp`, –æ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å—ë –µ—â—ë –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç root.

–ï—Å–ª–∏ —ç—Ç–æ–≥–æ –Ω–µ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:
- `kubectl` (–∏–ª–∏ `flux`) –Ω–µ —Å–º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥
- –ü—Ä–∏–¥—ë—Ç—Å—è –≤—Å–µ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å `kubectl` —Å `sudo`, —á—Ç–æ –Ω–µ—É–¥–æ–±–Ω–æ

–ü–æ—ç—Ç–æ–º—É –º—ã –≥–æ–≤–æ—Ä–∏–º —Å–∏—Å—Ç–µ–º–µ: ¬´–°–¥–µ–ª–∞–π –≤–ª–∞–¥–µ–ª—å—Ü–µ–º —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ **–º–æ–π —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –∏ –µ–≥–æ –æ—Å–Ω–æ–≤–Ω—É—é –≥—Ä—É–ø–ø—É¬ª.

–í –∏—Ç–æ–≥–µ –≤—ã —Å–º–æ–∂–µ—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫–ª–∞—Å—Ç–µ—Ä–æ–º –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –±–µ–∑ `sudo`.

---

## 5. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –Ω–∞ GitHub

–°–æ–∑–¥–∞–π—Ç–µ —Ç—Ä–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:

1. [`my-app`](https://github.com/belkanaphan-sensation/tournament-ss) ‚Äî –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è + Dockerfile
2. [`my-charts`](https://github.com/belkanaphan-sensation/chart) ‚Äî Helm Chart
3. [`my-infra`](https://github.com/belkanaphan-sensation/infra) ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ HelmRelease (GitOps)

---

## 6. –°–±–æ—Ä–∫–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è Docker-–æ–±—Ä–∞–∑–∞

### –°–æ–∑–¥–∞–Ω–∏–µ Dockerfile

–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ `my-app` —Å–æ–∑–¥–∞–π—Ç–µ `Dockerfile`:

```dockerfile
# –≠—Ç–∞–ø —Å–±–æ—Ä–∫–∏
FROM eclipse-temurin:23-jdk-alpine AS build

WORKDIR /app

COPY build.gradle settings.gradle ./
COPY gradlew .
COPY gradle ./gradle
COPY src ./src

RUN chmod +x gradlew
RUN ./gradlew build -x test

# –§–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑
FROM eclipse-temurin:23-jdk-alpine

WORKDIR /app
COPY --from=build /app/build/libs/*.jar app.jar

EXPOSE 8080

ENTRYPOINT ["java", "-jar", "app.jar"]
```

### –°–±–æ—Ä–∫–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–∞

–°–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ **GitHub Container Registry (GHCR)**:

```bash
# –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
docker build --platform linux/amd64 -t ghcr.io/belkanaphan-sensation/tournament-ss:0.0.1-SNAPSHOT .

# –õ–æ–≥–∏–Ω –≤ GHCR
echo $CR_PAT | docker login ghcr.io -u belkanaphan --password-stdin

# –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—Ä–∞–∑–∞ –≤ GHCR
docker push ghcr.io/belkanaphan-sensation/tournament-ss:0.0.1-SNAPSHOT
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `$CR_PAT` = GitHub Personal Access Token —Å –ø—Ä–∞–≤–∞–º–∏ `write:packages`.

### –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞

#### –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞

```bash
docker build -t ghcr.io/<github-username>/<app-name>:v1 .
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- `docker build` ‚Äî —Å–æ–±–∏—Ä–∞–µ–º Docker-–æ–±—Ä–∞–∑
- `-t ghcr.io/...` ‚Äî –¥–∞—ë–º –µ–º—É —Ç–µ–≥ (–Ω–∞–∑–≤–∞–Ω–∏–µ)
  - `ghcr.io` ‚Üí —Ä–µ–µ—Å—Ç—Ä GitHub (GitHub Container Registry)
  - `<github-username>` ‚Üí –≤–∞—à GitHub –ª–æ–≥–∏–Ω
  - `<app-name>` ‚Üí –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è/—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
  - `:v1` ‚Üí –≤–µ—Ä—Å–∏—è (—Ç–µ–≥). –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `:latest`
- `.` ‚Üí –ø—É—Ç—å –∫ `Dockerfile` (—Ç–æ—á–∫–∞ = —Ç–µ–∫—É—â–∞—è –ø–∞–ø–∫–∞)

#### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ GHCR

```bash
echo $CR_PAT | docker login ghcr.io -u <github-username> --password-stdin
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- GitHub —Ç—Ä–µ–±—É–µ—Ç **–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω (PAT)** –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ GHCR
- `$CR_PAT` ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å —Ç–æ–∫–µ–Ω–æ–º
  - –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω –≤ [GitHub ‚Üí Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Tokens (classic)](https://github.com/settings/tokens)
  - –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∞: `write:packages`, `read:packages`, `delete:packages`
- `docker login ghcr.io` ‚Äî –ª–æ–≥–∏–Ω–∏–º—Å—è –≤ —Ä–µ–µ—Å—Ç—Ä
- `--password-stdin` ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–µ—Ä–µ–¥–∞—ë–º —Ç–æ–∫–µ–Ω –≤ Docker

–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—É—á–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: **Login Succeeded**

#### –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—Ä–∞–∑–∞ –≤ GHCR

```bash
docker push ghcr.io/<github-username>/<app-name>:v1
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Å–æ–±—Ä–∞–Ω–Ω—ã–π –æ–±—Ä–∞–∑ –≤ GitHub Container Registry
- –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ–±—Ä–∞–∑ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ GitHub –∏ –µ–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
  - –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (`docker pull ghcr.io/<username>/<app-name>:v1`)
  - –í Kubernetes (–≤ `Deployment.yaml`)

---

## 7. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Flux –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é infra

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è infra

```
dev/
‚îú‚îÄ‚îÄ chart-repo.yaml
‚îî‚îÄ‚îÄ helmrelease.yaml
prod/
‚îú‚îÄ‚îÄ chart-repo.yaml
‚îî‚îÄ‚îÄ helmrelease.yaml
flux-system/
‚îú‚îÄ‚îÄ kustomization.yaml
‚îî‚îÄ‚îÄ gitrepository.yaml
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è FluxCD

–ü–æ—Å–∫–æ–ª—å–∫—É —á–∞—Ä—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ Git, –Ω–∞–º –Ω—É–∂–µ–Ω `GitRepository`, –∞ –Ω–µ `HelmRepository`.

#### flux-system/gitrepository.yaml

```yaml
apiVersion: source.toolkit.fluxcd.io/v1
kind: GitRepository
metadata:
  name: infra
  namespace: flux-system
spec:
  interval: 1m
  url: https://github.com/belkanaphan-sensation/infra
```

#### flux-system/kustomization.yaml

```yaml
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: infra
  namespace: flux-system
spec:
  interval: 1m
  path: "./prod"
  prune: true
  sourceRef:
    kind: GitRepository
    name: infra
```

#### prod/chart-repo.yaml

```yaml
apiVersion: source.toolkit.fluxcd.io/v1
kind: GitRepository
metadata:
  name: chart-repo
  namespace: flux-system
spec:
  interval: 1m
  url: https://github.com/belkanaphan-sensation/chart
```

### –†–∞–±–æ—Ç–∞ —Å –ø—É–±–ª–∏—á–Ω—ã–º–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏

–ï—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—É–±–ª–∏—á–Ω—ã–µ ‚Äî –Ω–∏—á–µ–≥–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ üöÄ Flux —Å–∞–º –∏—Ö –∫–ª–æ–Ω–∏—Ä—É–µ—Ç –ø–æ HTTPS.

### –†–∞–±–æ—Ç–∞ —Å –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏

–ï—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ, —Å–æ–∑–¥–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç —Å SSH-–∫–ª—é—á–æ–º –∏–ª–∏ —Ç–æ–∫–µ–Ω–æ–º GitHub. (–ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∞)

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH-–∫–ª—é—á–∞

1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
   ```bash
   ssh-keygen -t ed25519 -C "flux@yourdomain" -f ./flux-key -N ""
   ```

2. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞ –≤ GitHub:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ GitHub ‚Üí Settings ‚Üí Deploy keys
   - –î–æ–±–∞–≤—å—Ç–µ `flux-key.pub` –∫–∞–∫ **Deploy key —Å –ø—Ä–∞–≤–æ–º read**

3. **–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞ –≤ Kubernetes:**
   ```bash
   kubectl create secret generic flux-git-deploy \
     --from-file=identity=./flux-key \
     -n flux-system
   ```

4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ GitRepository:**
   ```yaml
   spec:
     url: ssh://git@github.com/belkanaphan-sensation/infra
     secretRef:
       name: flux-git-deploy
   ```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã Flux

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ GitRepository
kubectl get gitrepositories -n flux-system
kubectl describe gitrepository infra -n flux-system

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —Å–¥–µ–ª–∞–Ω–æ)
git clone https://github.com/belkanaphan-sensation/chart.git
git clone https://github.com/belkanaphan-sensation/infra.git
```

---

## 8. –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (–≥–¥–µ –±—É–¥–µ—Ç prod)

#### 8.1. –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø–∞–ø–∫—É —Å –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞–º–∏

```bash
cd infra
```

#### 8.2. –°–æ–∑–¥–∞–Ω–∏–µ namespace

```bash
kubectl create namespace prod
```

#### 8.3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ GitRepository –∏ Kustomization

```bash
# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Flux
kubectl apply -f flux-system/
kubectl apply -f prod/
```

#### 8.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

```bash
kubectl get gitrepositories -n flux-system
kubectl get kustomizations -n flux-system
kubectl get helmreleases -n prod
```

#### 8.5. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± (–ª–æ–∫–∞–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ)

> **‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:** –≠—Ç–æ—Ç —Å–ø–æ—Å–æ–± –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–ü—Ä—è–º–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —á–∞—Ä—Ç–∞:**
```bash
kubectl apply -f chart/templates/
```

**–ß–µ—Ä–µ–∑ Helm:**
```bash
helm upgrade --install sensation ./chart -n prod --create-namespace -f infra/prod/values.yaml
```

**–†–µ–∑—é–º–µ:**
- **–ß–µ—Ä–µ–∑ Flux:** `kubectl apply -f flux-system/ && kubectl apply -f prod/`
- **–ù–∞–ø—Ä—è–º—É—é (–¥–ª—è —Ç–µ—Å—Ç–∞):** `helm upgrade --install sensation ./chart -n prod -f infra/prod/values.yaml`

---

## 9. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ GHCR

### 9.1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ GHCR

```bash
kubectl create secret docker-registry ghcr-secret \
  --docker-server=ghcr.io \
  --docker-username=<–≤–∞—à-github-–ª–æ–≥–∏–Ω> \
  --docker-password=<CR_PAT> \
  --docker-email=<email> \
  -n prod
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, —á—Ç–æ–±—ã kubelet –º–æ–≥ –ø–æ–¥—Ç—è–Ω—É—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –æ–±—Ä–∞–∑.

### 9.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HelmRelease/values.yaml

–í `values.yaml` —É–∫–∞–∂–∏—Ç–µ –∏–º—è –æ–±—Ä–∞–∑–∞ –∏ —Å–µ–∫—Ä–µ—Ç:

```yaml
tournament:
  enabled: true
  image: ghcr.io/belkanaphan-sensation/tournament-ss:0.0.1-SNAPSHOT
  imagePullSecrets:
    - name: ghcr-secret
```

### 9.3. –î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Helm/FluxCD

```bash
helm upgrade --install tournament ./chart -f values.yaml
```

Kubernetes –ø–æ–¥—Ç—è–Ω–µ—Ç –æ–±—Ä–∞–∑ —Å GHCR, –∏—Å–ø–æ–ª—å–∑—É—è —Å–µ–∫—Ä–µ—Ç `ghcr-secret`.

---

## 10. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–ß—Ç–æ–±—ã –ø–æ–¥ –º–æ–≥ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω–µ `localhost:9432`, –∞ IP/Service, –Ω–∞–ø—Ä–∏–º–µ—Ä `192.168.1.89:9432`.

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `localhost` –≤–Ω—É—Ç—Ä–∏ –ø–æ–¥–∞ ‚Äî —ç—Ç–æ —Å–∞–º –ø–æ–¥. –û–Ω –Ω–µ –≤–∏–¥–∏—Ç Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞ —Ö–æ—Å—Ç–µ
- –ü–æ—Ä—Ç 9432 –ø—Ä–æ–±—Ä–æ—à–µ–Ω –Ω–∞ —Ö–æ—Å—Ç–µ, –Ω–æ –ø–æ–¥—ã Kubernetes –Ω–µ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ –Ω–µ–º—É –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `localhost`

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ Postgres –≤ Kubernetes

–°–æ–∑–¥–∞–π—Ç–µ `Deployment` –∏ `Service` –¥–ª—è Postgres:

```yaml
apiVersion: v1
kind: Service
metadata:
  name: postgres
  namespace: prod
spec:
  ports:
    - port: 5432
      targetPort: 5432
  selector:
    app: postgres
```

Backend –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫–∞–∫:
```
jdbc:postgresql://postgres:5432/sensation
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π IP —Ö–æ—Å—Ç–∞

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞ —Ö–æ—Å—Ç–µ, backend –≤ –ø–æ–¥–µ –¥–æ–ª–∂–µ–Ω –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ IP —Ö–æ—Å—Ç–∞:

```yaml
tournament:
  env:
    - name: SPRING_DATASOURCE_URL
      value: jdbc:postgresql://192.168.1.89:9432/sensation
```

> **‚ö†Ô∏è –í–∞–∂–Ω–æ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ firewall/iptables –Ω–∞ —Ö–æ—Å—Ç–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å –ø–æ–¥–æ–≤ Kubernetes –∫ –ø–æ—Ä—Ç—É 9432.

### –í–∞—Ä–∏–∞–Ω—Ç 3: Port Forwarding (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```bash
kubectl port-forward pod/<pod-name> 5432:5432
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∏ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.

---

## 11. –î–æ—Å—Ç—É–ø –∫ Swagger

–ß—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å Swagger –Ω–∞ —Ä–∞–±–æ—á–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ, –Ω—É–∂–Ω–æ –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—å –ø–æ—Ä—Ç –∏–∑ Kubernetes –ø–æ–¥–∞ –Ω–∞—Ä—É–∂—É.

### 11.1. –ß–µ—Ä–µ–∑ kubectl port-forward (—Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–±)

**–ù–∞ —Ä–∞–±–æ—á–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:**

1. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ SSH —Å –ø—Ä–æ–±—Ä–æ—Å–æ–º –ø–æ—Ä—Ç–∞:**
   ```bash
   ssh -L 8080:localhost:8080 elena@<IP_–¥–æ–º–∞—à–Ω–µ–≥–æ_—Å–µ—Ä–≤–µ—Ä–∞>
   ```

2. **–ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ –¥–æ –ø–æ–¥–∞ —á–µ—Ä–µ–∑ kubectl:**
   ```bash
   kubectl port-forward pod/tournament-<SUFFIX> 8080:8080 -n prod
   ```

3. **–û—Ç–∫—Ä—ã—Ç–∏–µ Swagger –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
   ```
   http://localhost:8080/swagger-ui.html
   ```
   –∏–ª–∏
   ```
   http://localhost:8080/swagger
   ```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `8080` ‚Äî –ø–æ—Ä—Ç –Ω–∞ —Ä–∞–±–æ—á–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π, –µ—Å–ª–∏ –∑–∞–Ω—è—Ç)
- `<IP_–¥–æ–º–∞—à–Ω–µ–≥–æ_—Å–µ—Ä–≤–µ—Ä–∞>` ‚Äî IP –¥–æ–º–∞—à–Ω–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- `tournament-<SUFFIX>` ‚Äî –∏–º—è –ø–æ–¥–∞ (–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á–µ—Ä–µ–∑ `kubectl get pods -n prod`)

### 11.2. –ß–µ—Ä–µ–∑ NodePort/LoadBalancer (–¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã Swagger –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞–ø—Ä—è–º—É—é –ø–æ IP —Å–µ—Ä–≤–µ—Ä–∞:

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Service —Å —Ç–∏–ø–æ–º NodePort:**

```yaml
apiVersion: v1
kind: Service
metadata:
  name: tournament-service
  namespace: prod
spec:
  type: NodePort
  selector:
    app: tournament
  ports:
    - protocol: TCP
      port: 8080
      targetPort: 8080
      nodePort: 30080   # –ø–æ—Ä—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è (`kubectl apply -f service.yaml`) Swagger –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ:
```
http://<IP_–¥–æ–º–∞—à–Ω–µ–≥–æ_—Å–µ—Ä–≤–µ—Ä–∞>:30080/swagger
```

---

## 12. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –£–¥–∞–ª–µ–Ω–∏–µ K3s

**–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è k3s —Å —Å–µ—Ä–≤–µ—Ä–∞/–≥–ª–∞–≤–Ω–æ–≥–æ —É–∑–ª–∞:**
```bash
sudo /usr/local/bin/k3s-uninstall.sh
```

**–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è k3s —Å –∞–≥–µ–Ω—Ç–∞/—Ä–∞–±–æ—á–µ–≥–æ —É–∑–ª–∞:**
```bash
sudo /usr/local/bin/k3s-agent-uninstall.sh
```

---